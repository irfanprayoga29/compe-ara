name: Dump Mach-O Binary

on: [push]

jobs:
  dump:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install LLVM
      run: |
        brew update
        brew install llvm

    - name: Add LLVM to PATH
      run: echo "$(brew --prefix llvm)/bin" >> $GITHUB_PATH

    - name: Make binary executable
      run: chmod +x invitation-party

    - name: List Mach-O sections
      run: llvm-objdump -h invitation-party > sections.txt

    - name: Dump cstring section
      run: llvm-objdump -s --section=__cstring invitation-party > cstring.txt || true

    - name: Dump const section
      run: llvm-objdump -s --section=__const invitation-party > const.txt || true

    - name: Dump data section
      run: llvm-objdump -s --section=__data invitation-party > data.txt || true

    - name: Disassemble
      run: llvm-objdump -d invitation-party > disasm.txt

    - name: Dump strings
      run: strings invitation-party > strings.txt

    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: invitation-party-dump
        path: |
          sections.txt
          cstring.txt
          const.txt
          data.txt
          disasm.txt
          strings.txt
